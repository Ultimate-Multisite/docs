---
title: Интеграция с Cloudflare
sidebar_position: 16
_i18n_hash: 41bd975db7c89a129f5f880b439a8f2f
---
# Cloudflare Интеграция

## Обзор
Cloudflare является ведущей сетью доставки контента (CDN) и поставщиком безопасности, который помогает защищать и ускорять веб‑сайты. Эта интеграция позволяет автоматически управлять доменами между Ultimate Multisite и Cloudflare, особенно для установок мультисайтов с поддоменами.

## Функции
- Автоматическое создание поддомена в Cloudflare
- Поддержка проксируемых поддоменов
- Управление записями DNS
- Улучшенное отображение записей DNS в админке Ultimate Multisite

## Требования
Следующие константы должны быть определены в вашем файле `wp-config.php`:

```php
define('WU_CLOUDFLARE_API_KEY', 'your_api_key');
define('WU_CLOUDFLARE_ZONE_ID', 'your_zone_id');
```

## Инструкции по настройке

### 1. Получите ваш API‑ключ Cloudflare
1. Войдите в вашу панель управления Cloudflare  
2. Перейдите в «Мой профиль» (нажмите на вашу электронную почту в правом верхнем углу)  
3. Выберите «API Tokens» в меню  
4. Создайте новый токен API с следующими разрешениями:  
   - Zone.Zone: Read  
   - Zone.DNS: Edit  
5. Скопируйте ваш токен API

### 2. Получите ваш ID зоны
1. В панели управления Cloudflare выберите домен, который вы хотите использовать  
2. ID зоны виден во вкладке «Overview», в правой боковой панели под «API»  
3. Скопируйте ID зоны

### 3. Добавьте константы в wp-config.php
```php
define('WU_CLOUDFLARE_API_KEY', 'your_api_token');
define('WU_CLOUDFLARE_ZONE_ID', 'your_zone_id');
```

### 4. Включите интеграцию
1. В админке WordPress перейдите в Ultimate Multisite > Settings  
2. Перейдите на вкладку «Domain Mapping»  
3. Прокрутите вниз до «Host Integrations»  
4. Включите интеграцию Cloudflare  
5. Нажмите «Save Changes»

## Как это работает

### Управление поддоменами
Когда создается новый сайт в установке мультисайта с поддоменом:
1. Интеграция отправляет запрос к API Cloudflare для добавления записи CNAME для поддомена  
2. Поддомен по умолчанию настроен на проксирование через Cloudflare (это можно изменить с помощью фильтров)  
3. При удалении сайта интеграция удалит поддомен из Cloudflare

### Отображение записей DNS
Интеграция улучшает отображение записей DNS в админке Ultimate Multisite следующим образом:
1. Получение записей DNS напрямую из Cloudflare  
2. Отображение того, проксированы ли записи  
3. Отображение дополнительной информации о записях DNS

## Важные примечания
С последних обновлений Cloudflare, проксирование wildcard теперь доступно для всех клиентов. Это означает, что интеграция Cloudflare менее критична для установок мультисайтов с поддоменами, чем раньше, поскольку вы можете просто настроить запись wildcard DNS в Cloudflare.

## Устранение неполадок

### Проблемы с подключением к API
- Убедитесь, что ваш токен API правильный и имеет необходимые разрешения  
- Проверьте, что ваш ID зоны правильный  
- Убедитесь, что у вашего аккаунта Cloudflare есть необходимые разрешения  

### Поддомен не добавлен
- Проверьте логи Ultimate Multisite на наличие сообщений об ошибках  
- Убедитесь, что поддомен еще не добавлен в Cloudflare  
- Убедитесь, что ваш план Cloudflare поддерживает количество создаваемых записей DNS  

### Проблемы с проксированием
- Если вы не хотите, чтобы поддомены проксировались, вы можете использовать фильтр `wu_cloudflare_should_proxy`  
- Некоторые функции могут работать некорректно при проксировании (например, определенные функции админки WordPress)  
- Рассмотрите возможность использования правил страницы Cloudflare для обхода кэша для страниц админки  
