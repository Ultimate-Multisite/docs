---
title: یکپارچه‌سازی Cloudflare
sidebar_position: 16
_i18n_hash: 41bd975db7c89a129f5f880b439a8f2f
---
# یکپارچه‌سازی با Cloudflare

## معرفی
Cloudflare یکی از پیشروترین شبکه‌های تحویل محتوا (CDN) و ارائه‌دهندگان امنیتی است که به محافظت و افزایش سرعت وب‌سایت‌ها کمک می‌کند. این یکپارچه‌سازی امکان مدیریت خودکار دامنه بین Ultimate Multisite و Cloudflare را فراهم می‌کند، به‌ویژه برای نصب‌های multisite با زیردامنه.

## امکانات
- ایجاد خودکار زیردامنه در Cloudflare
- پشتیبانی از زیردامنه‌های پروکسی‌شده
- مدیریت رکوردهای DNS
- نمایش بهبودیافته رکوردهای DNS در پنل مدیریت Ultimate Multisite

## پیش‌نیازها
ثابت‌های زیر باید در فایل `wp-config.php` شما تعریف شوند:

```php
define('WU_CLOUDFLARE_API_KEY', 'your_api_key');
define('WU_CLOUDFLARE_ZONE_ID', 'your_zone_id');
```

## راهنمای راه‌اندازی

### ۱. دریافت کلید API از Cloudflare

1. وارد داشبورد Cloudflare خود شوید
2. به بخش "My Profile" بروید (روی ایمیل خود در گوشه بالا-راست کلیک کنید)
3. از منو گزینه "API Tokens" را انتخاب کنید
4. یک API token جدید با مجوزهای زیر بسازید:
   - Zone.Zone: Read
   - Zone.DNS: Edit
5. API token خود را کپی کنید

### ۲. دریافت Zone ID

1. در داشبورد Cloudflare، دامنه موردنظر خود را انتخاب کنید
2. Zone ID در تب "Overview"، در نوار کناری سمت راست زیر بخش "API" قابل مشاهده است
3. Zone ID را کپی کنید

### ۳. افزودن ثابت‌ها به wp-config.php

ثابت‌های زیر را به فایل `wp-config.php` خود اضافه کنید:

```php
define('WU_CLOUDFLARE_API_KEY', 'your_api_token');
define('WU_CLOUDFLARE_ZONE_ID', 'your_zone_id');
```

### ۴. فعال‌سازی یکپارچه‌سازی

1. در پنل مدیریت WordPress، به Ultimate Multisite > Settings بروید
2. به تب "Domain Mapping" بروید
3. به پایین صفحه اسکرول کنید تا به "Host Integrations" برسید
4. یکپارچه‌سازی Cloudflare را فعال کنید
5. روی "Save Changes" کلیک کنید

## نحوه کارکرد

### مدیریت زیردامنه

وقتی سایت جدیدی در یک نصب multisite با زیردامنه ایجاد می‌شود:

1. یکپارچه‌سازی یک درخواست به API Cloudflare می‌فرستد تا یک رکورد CNAME برای زیردامنه اضافه کند
2. زیردامنه به‌صورت پیش‌فرض برای پروکسی شدن از طریق Cloudflare پیکربندی می‌شود (این قابلیت با فیلترها قابل تغییر است)
3. وقتی سایتی حذف می‌شود، یکپارچه‌سازی زیردامنه را از Cloudflare حذف می‌کند

### نمایش رکوردهای DNS

این یکپارچه‌سازی نمایش رکوردهای DNS را در پنل مدیریت Ultimate Multisite بهبود می‌بخشد با:

1. دریافت مستقیم رکوردهای DNS از Cloudflare
2. نمایش وضعیت پروکسی بودن یا نبودن رکوردها
3. نمایش اطلاعات اضافی درباره رکوردهای DNS

## نکات مهم

طبق به‌روزرسانی‌های اخیر Cloudflare، پروکسی wildcard اکنون برای همه کاربران در دسترس است. این یعنی یکپارچه‌سازی Cloudflare برای نصب‌های multisite با زیردامنه کمتر از گذشته حیاتی است، زیرا می‌توانید به‌سادگی یک رکورد DNS wildcard در Cloudflare تنظیم کنید.

## عیب‌یابی

### مشکلات اتصال به API
- مطمئن شوید که API token شما صحیح است و مجوزهای لازم را دارد
- بررسی کنید که Zone ID شما درست باشد
- اطمینان حاصل کنید که حساب Cloudflare شما مجوزهای لازم را دارد

### زیردامنه اضافه نمی‌شود
- لاگ‌های Ultimate Multisite را برای پیام‌های خطا بررسی کنید
- مطمئن شوید که زیردامنه قبلاً به Cloudflare اضافه نشده باشد
- اطمینان حاصل کنید که پلن Cloudflare شما از تعداد رکوردهای DNS که می‌خواهید بسازید پشتیبانی می‌کند

### مشکلات پروکسی
- اگر نمی‌خواهید زیردامنه‌ها پروکسی شوند، می‌توانید از فیلتر `wu_cloudflare_should_proxy` استفاده کنید
- برخی امکانات ممکن است هنگام پروکسی شدن درست کار نکنند (مثلاً برخی توابع پنل مدیریت WordPress)
- استفاده از Page Rules در Cloudflare را برای دور زدن کش در صفحات مدیریت در نظر بگیرید
