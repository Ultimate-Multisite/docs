---
title: マルチサイト設定ウィザード
sidebar_position: 3
_i18n_hash: fd09dc94f24b0b37245b847380feea3f
---
# マルチサイトセットアップウィザード

Ultimate Multisite には、標準の WordPress インストールを自動的に WordPress マルチサイトネットワークに変換する組み込みウィザードが含まれています。これにより、`wp-config.php` を手動で編集したり、データベースコマンドを実行したりする必要がなくなります。

:::tip
WordPress インストールがすでにマルチサイトネットワークとして動作している場合は、このステップを完全にスキップできます。ウィザードはマルチサイトがまだ有効になっていない場合にのみ表示されます。
:::

## ウィザードはいつ表示されますか？

Ultimate Multisite を標準（非マルチサイト）WordPress インストールで有効化すると、プラグインはマルチサイトが有効になっていないことを検出し、通常のセットアップウィザードではなくマルチサイトセットアップウィザードに自動的にリダイレクトします。

また、**WP Admin > Ultimate Multisite > Multisite Setup** で直接アクセスすることもできます。

## 前提条件

ウィザードを実行する前に、次のことを確認してください。

- WordPress インストールへの **管理者アクセス** があること
- サーバーの `wp-config.php` ファイルが **ウェブサーバーによって書き込み可能** であること
- ファイルとデータベースの **最近のバックアップ** があること

:::warning
ウィザードは `wp-config.php` ファイルを変更し、新しいデータベーステーブルを作成します。進行する前に必ずバックアップを作成してください。
:::

## ステップ 1: ウェルカム

最初の画面では、WordPress マルチサイトとは何か、ウィザードが何を行うかが説明されます。

- WordPress 設定でマルチサイト機能を有効化
- 必要なネットワークデータベーステーブルを作成
- `wp-config.php` に必要なマルチサイト定数を追加
- ネットワーク全体で Ultimate Multisite をネットワーク有効化

![マルチサイトセットアップウィザード - ウェルカムステップ](/img/installation/multisite-wizard/wizard-welcome.png)

**Continue** をクリックして進みます。

## ステップ 2: ネットワーク設定

このステップでは、ネットワーク設定を構成します。

### サイト構造

ネットワークサイトの構成方法を選択します。

- **サブドメイン**（推奨） — サイトは独自のサブドメインを取得します。例：`site1.yourdomain.com`
- **サブディレクトリ** — サイトはパスとして作成されます。例：`yourdomain.com/site1`

:::note
サブドメインを選択した場合、ドメインに **ワイルドカードDNS** と **ワイルドカードSSL証明書** を設定する必要があります。ほとんどのマネージドWordPressホストは自動で処理します。詳細な比較は [Ultimate Multisite 101](./ultimate-multisite-101) をご覧ください。
:::

### ネットワークタイトル

ネットワークの名前を入力します。デフォルトでは現在のサイトタイトルに「Network」を追加したものです。後でネットワーク設定から変更できます。

### ネットワーク管理者メール

ネットワーク管理通知に使用されるメールアドレスです。デフォルトでは現在のユーザーのメールアドレスが設定されています。

![マルチサイトセットアップウィザード - ネットワーク設定](/img/installation/multisite-wizard/wizard-network-configuration.png)

フィールドを入力したら **Continue** をクリックして進みます。

## ステップ 3: インストール

**Install** ボタンをクリックして開始します。ウィザードは順序立てて 5 つの自動ステップを実行し、進行状況をリアルタイムで表示します。

![マルチサイトセットアップウィザード - インストール保留中](/img/installation/multisite-wizard/wizard-installation-pending.png)

| ステップ | 説明 |
|------|-------------|
| **Multisiteを有効化** | `wp-config.php` に `WP_ALLOW_MULTISITE` 定数を追加 |
| **ネットワークを作成** | マルチサイトのデータベーステーブル（`wp_site`、`wp_sitemeta`、`wp_blogs` など）を作成し、ネットワーク設定で埋め込みます |
| **設定を更新** | `wp-config.php` に最終的なマルチサイト定数（`MULTISITE`、`SUBDOMAIN_INSTALL`、`DOMAIN_CURRENT_SITE` など）を追加 |
| **クッキーを修正** | ネットワークメタデータ内のサイトURLが正しいことを確認し、アクティベーション後の認証問題を防ぎます |
| **プラグインをネットワーク有効化** | Ultimate Multisite をネットワーク有効化し、ネットワーク全体で実行します |

各ステップは次のステータスのいずれかを表示します。

- **保留中** — 処理待ち
- **インストール中...** — 現在実行中
- **成功！** — 正常に完了
- **エラーメッセージ** — エラーが発生（メッセージで問題が説明されます）

すべてのステップが正常に完了すると、各項目に緑色の「成功！」ステータスが表示されます。

![マルチサイトセットアップウィザード - インストール完了](/img/installation/multisite-wizard/wizard-installation-complete.png)

ウィザードは自動的に完了画面に進みます。

## ステップ 4: 完了

インストールが完了すると、WordPress マルチサイトが有効化されたことを確認する成功メッセージが表示されます。

![マルチサイトセットアップウィザード - セットアップ完了](/img/installation/multisite-wizard/wizard-complete.png)

ここからは Ultimate Multisite のセットアップウィザードを続行し、WaaS プラットフォーム（会社情報、デフォルトコンテンツ、決済ゲートウェイなど）を構成できます。

:::note
マルチサイトのインストールが完了すると、ブラウザは新しく有効化されたネットワーク管理画面にリダイレクトされます。認証クッキーがマルチサイト環境に合わせて更新されるため、再度ログインが必要になる場合があります。
:::

## 手動セットアップフォールバック

ウィザードが `wp-config.php` ファイルに書き込めない場合（ファイルパーミッションやサーバー制限が原因）、手動で追加する必要がある正確なコードが表示されます。

1. `/* That's all, stop editing! */` 行の上に追加する必要がある **wp-config.php 定数**  
2. 選択したサイト構造（サブドメインまたはサブディレクトリ）に適した **.htaccess リライトルール**

手動で変更を行った後、ページをリフレッシュするとウィザードがマルチサイトが有効になったことを検出します。

## トラブルシューティング

### ウィザードが wp-config.php が書き込み不可と表示する場合

ウェブサーバーのプロセスに `wp-config.php` ファイルへの書き込み権限が必要です。次のいずれかを行うことができます。

- 一時的にファイルのパーミッションを `644` または `666` に変更する
- ウィザードが提供する手動セットアップフォールバックの指示を使用する
- ホスティングプロバイダーにサポートを依頼する

### 設定後にサイトがアクセスできない（サブドメイン）

サブドメイン構造を選択した場合、ドメインに **ワイルドカードDNS** を設定する必要があります。DNSレコードを追加してください：

```
タイプ: A (または CNAME)
ホスト: *
値: [あなたのサーバーIP]
```

設定方法が不明な場合は、ホスティングプロバイダーに確認してください。

### 設定後の認証問題

マルチサイト設定後にログアウトしているか、クッキーエラーが発生した場合：

- サイトのブラウザクッキーをクリアする
- `yourdomain.com/wp-login.php` で再度ログインする
- 問題が解決しない場合、`wp-config.php` に `COOKIE_DOMAIN` が `false` に設定されていないか確認してください。これはサブドメインマルチサイトインストールで知られた問題です。

### インストール中にステップが失敗した場合

- 表示されたエラーメッセージをメモする
- 設定ステップに戻り、再試行する
- エラーが続く場合は、サーバーの PHP エラーログを確認して詳細を確認する
- すでに完了したステップは、次回の実行時にスキップされます（インストーラーは冪等です）
